- name: Install OpenSRF Rust Environment
  shell: curl https://sh.rustup.rs -sSf | sh -s -- -y
  become: true
  become_user: opensrf
- name: Checkout OpenSRF Rust Repository
  git:
    repo: "{{osrf_router_git_repository}}"
    dest: "{{repo_base}}/evergreen-universe-rs"
    depth: "{{osrf_router_clone_depth}}"
    version: "{{osrf_router_git_branch}}"
    force: "{{force_git_checkout}}"
  become: true
  become_user: opensrf
  when: perform_git_checkout
- name: Download and Build OpenSRF Rust (may take a few mins)
  environment:
    PATH: /home/opensrf/.cargo/bin:{{ ansible_env.PATH }}
  shell: cd {{repo_base}}/evergreen-universe-rs && cargo build --package opensrf --release
  become: true
  become_user: opensrf
- name: Install OpenSRF Router
  copy:
    src: "{{repo_base}}/evergreen-universe-rs/target/release/opensrf-router"
    dest: "{{eg_install_path}}/bin/opensrf-router"
    owner: opensrf
    group: opensrf
    mode: '0700'
  become: true
  become_user: opensrf
