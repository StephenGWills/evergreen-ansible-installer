- name: Install OpenSRF Pre-Prereqs
  become: true
  apt: name=make state=present
  with_items:
    - make
    - git
- name: Create opensrf user
  become: true
  user:
    name: opensrf
    shell: /bin/bash
# Environment changes added to ~/.bash_profile to ensure they are 
# loaded regardless of whether opensrf is used interactively.
- name: Check export PATH for opensrf user profile
  become: true
  become_user: opensrf
  lineinfile: 
    dest: /home/opensrf/.bash_profile
    create: yes
    owner: opensrf
    group: opensrf
    mode: 0644
    regexp: '^export PATH=' 
    line: 'export PATH="{{eg_install_path}}/bin:$PATH"'
- name: Check LD_LIBRARY_PATH for opensrf user profile
  become: true
  become_user: opensrf
  lineinfile: 
    dest: /home/opensrf/.bash_profile
    regexp: '^export LD_LIBRARY_PATH=' 
    line: 'export LD_LIBRARY_PATH="{{eg_install_path}}/lib:/usr/local/lib:/usr/local/lib/dbd:$LD_LIBRARY_PATH"'
- name: Add public/private jabber hosts to /etc/hosts
  become: true
  lineinfile: 
    dest: /etc/hosts
    regexp: '^{{jabber_domain_addr}} public'
    line: '{{jabber_domain_addr}} public.{{jabber_domain}} private.{{jabber_domain}}'
