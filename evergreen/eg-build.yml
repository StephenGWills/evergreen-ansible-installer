- name: Checkout Evergreen Repository
  git:
    repo: "{{eg_git_repository}}"
    dest: "{{repo_base}}/Evergreen"
    depth: "{{eg_clone_depth}}"
    version: "{{eg_git_branch}}"
- name: Install Evergreen Prereqs
  become: true
  shell: >
    cd {{repo_base}}/Evergreen 
    && PERL_MM_USE_DEFAULT=1 make -f 
    Open-ILS/src/extras/Makefile.install {{os_build_target}}
- file: dest="{{repo_base}}" owner=opensrf group=opensrf recurse=yes
- name: Build Evergreen
  become: true
  become_user: opensrf
  environment:
    PATH: "{{ansible_env.PATH}}:{{eg_install_path}}/bin"
  shell: >
    cd {{repo_base}}/Evergreen 
    && autoreconf -i 
    && ./configure --prefix={{eg_install_path}} --sysconfdir={{eg_install_path}}/conf 
    && make
- file: dest="{{eg_install_path}}" owner=opensrf group=opensrf recurse=yes
